<html>
  <head>
    <!-- A-Frameを読み込む -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- AR.jsを読み込む -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/2.2.1/aframe/build/aframe-ar.min.js"></script>




    
<style>
body {
  text-align: center;
}

.flex-row {
  display: flex;
  justify-content: center;
}

#video {
  border: 1px solid black;
  width: 320px;
  height: 240px;
}

#photo {
  border: 1px solid black;
  width: 320px;
  height: 240px;
}

#movie {
  border: 1px solid black;
  width: 320px;
  height: 240px;
}

#shoot,
#recode-start,
#recode-stop {
  width: 100px;
  margin: 5px auto;
  border: solid 1px skyblue;
  border-radius: 30px;
  background-color: skyblue;
}

#shoot:hover,
#recode-start:hover,
#recode-stop:hover {
  opacity: 0.7;
}

.hidd {
  display: none;
}

#recode-stop {
  animation: recodding 2s infinite;
}

p.ret-element {
  margin-top: 0;
}

@keyframes recodding {
  0% {
    opacity: 1;
    /* border: solid 1px skyblue;
    background-color: skyblue; */
  }

  50% {
    opacity: 0.3;
  }

  100% {
    opacity: 1;
  }
}

@media (width <=1000px) {
  .flex-row {
    display: block;
  }
}
  </style>



    
    
  </head>
  <body style="margin: 0; overflow: hidden">
    <!-- シーンの作成、VRモードのUI非表示 -->
    <a-scene embedded arjs="patternRatio: 0.75" vr-mode-ui="enabled: false" renderer="colorManagement: true">
      <a-assets>
        <!-- 3Dモデルを読み込む -->
        <a-asset-item id="on" src="ONchan.glb" scale="0.03 0.03 0.03"></a-asset-item>
      </a-assets>
      <!-- マーカーを設定する -->
      <a-marker type="pattern" url="markerON.patt">
        <!-- 3Dモデルを呼び出す -->
        <a-entity gltf-model="#on" rotation="-15 0 0"></a-entity>
      </a-marker>
      <!-- カメラを追加 -->
      <a-entity camera></a-entity>
    </a-scene>



    <div class="flex-row">
        <div class="camera">
            <video id="video"></video>
            <div id="shoot">撮影</div>
        </div>
        <img id="photo">
    </div>


    
  </body>
  <script>
      document.querySelector("a-scene").renderer.gammaOutput=true;
  </script>


  
  
  
  <script>
const video = document.querySelector('#video');
const canvas = document.createElement('canvas');

initVideoCamera();
initPhoto();
document.querySelector('#shoot').addEventListener('click', photoShoot);

/**
 * ビデオのカメラ設定(デバイスのカメラ映像をビデオに表示)
 */
function initVideoCamera() {
    navigator.mediaDevices.getUserMedia({ video: true, audio: false })
        .then((stream) => {
            video.srcObject = stream;
            video.play();
        })
        .catch(e => console.log(e));
}

/**
 * 写真の初期描画
 */
function initPhoto() {
    canvas.width = video.clientWidth;
    canvas.height = video.clientHeight;
    const context = canvas.getContext("2d");
    context.fillStyle = "#AAA";
    context.fillRect(0, 0, canvas.width, canvas.height);
    document.querySelector("#photo").src = canvas.toDataURL("image/png");
}

/**
 * 写真の撮影描画
 */
function photoShoot() {
    let drawSize = calcDrawSize();
    canvas.width = drawSize.width;
    canvas.height = drawSize.height;
    const context = canvas.getContext("2d");
    context.drawImage(video, 0, 0, canvas.width, canvas.height);
    document.querySelector("#photo").src = canvas.toDataURL("image/png");
}

/**
 * 描画サイズの計算
 * 縦横比が撮影(video)が大きい時は撮影の縦基準、それ以外は撮影の横基準で計算
 */
function calcDrawSize() {
    let videoRatio = video.videoHeight / video.videoWidth;
    let viewRatio = video.clientHeight / video.clientWidth;
    return videoRatio > viewRatio ?
        { height: video.clientHeight, width: video.clientHeight / videoRatio }
        : { height: video.clientWidth * videoRatio, width: video.clientWidth }
}
  </script>
  


  
</html>
