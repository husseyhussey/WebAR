<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚«ãƒ¡ãƒ©ç”»åƒä¿å­˜</title>
<style>
  video, canvas {
    border: 1px solid #ccc;
    max-width: 100%;
  }
</style>
</head>
<body>
<h1>ã‚«ãƒ¡ãƒ©ç”»åƒã‚’ä¿å­˜ã™ã‚‹</h1>

<!-- ã‚«ãƒ¡ãƒ©æ˜ åƒè¡¨ç¤º -->
<video id="camera" autoplay playsinline></video>
<br>

<!-- æ’®å½±ãƒœã‚¿ãƒ³ -->
<button id="captureBtn">ğŸ“¸ æ’®å½±</button>
<!-- ä¿å­˜ãƒªãƒ³ã‚¯ -->
<a id="downloadLink" download="photo.png" style="display:none;">ç”»åƒã‚’ä¿å­˜</a>
<br><br>

<!-- æ’®å½±ç”»åƒè¡¨ç¤ºç”¨ -->
<canvas id="snapshot" style="display:none;"></canvas>

<script>
(async function() {
    const video = document.getElementById('camera');
    const canvas = document.getElementById('snapshot');
    const captureBtn = document.getElementById('captureBtn');
    const downloadLink = document.getElementById('downloadLink');

    try {
        // ã‚«ãƒ¡ãƒ©æ˜ åƒå–å¾—ï¼ˆãƒªã‚¢ã‚«ãƒ¡ãƒ©å„ªå…ˆï¼‰
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" },
            audio: false
        });
        video.srcObject = stream;
    } catch (err) {
        alert("ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“: " + err.message);
        console.error(err);
        return;
    }

    // æ’®å½±ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
    captureBtn.addEventListener('click', () => {
        const ctx = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);

        // ç”»åƒãƒ‡ãƒ¼ã‚¿URLå–å¾—
        const imageData = canvas.toDataURL('image/png');

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯è¨­å®š
        downloadLink.href = imageData;
        downloadLink.style.display = 'inline';
        downloadLink.textContent = "ğŸ’¾ ä¿å­˜ã™ã‚‹";
    });
})();
</script>
</body>
</html>





<!--
ä½¿ã„æ–¹

ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã‚’ camera_save.html ãªã©ã®ãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜ã€‚
HTTPSç’°å¢ƒ ã¾ãŸã¯ localhost ã§ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰é–‹ãï¼ˆgetUserMedia ã¯å®‰å…¨ãªç’°å¢ƒã§ã®ã¿å‹•ä½œï¼‰ã€‚
ãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’æ±‚ã‚ã‚‹ã®ã§ã€Œè¨±å¯ã€ã€‚
ã€Œæ’®å½±ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨é™æ­¢ç”»ãŒå–å¾—ã•ã‚Œã€ã€Œä¿å­˜ã™ã‚‹ã€ãƒªãƒ³ã‚¯ã‹ã‚‰PNGå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã€‚


è£œè¶³

ã‚¹ãƒãƒ›ã®å ´åˆï¼šfacingMode: "environment" ã§èƒŒé¢ã‚«ãƒ¡ãƒ©ã‚’å„ªå…ˆã€‚
ä¿å­˜å½¢å¼å¤‰æ›´ï¼šcanvas.toDataURL('image/jpeg', 0.9) ã«ã™ã‚Œã°JPEGå½¢å¼ã§ä¿å­˜å¯èƒ½ã€‚
ã‚µãƒ¼ãƒä¿å­˜ï¼šfetch ã‚„ XMLHttpRequest ã§ imageData ã‚’é€ä¿¡ã™ã‚Œã°ã‚µãƒ¼ãƒå´ã«ä¿å­˜ã§ãã¾ã™ã€‚


ã‚‚ã—ã€Œæ’®å½±ã—ãŸç”»åƒã‚’ã‚µãƒ¼ãƒã«ç›´æ¥é€ä¿¡ã—ã¦ä¿å­˜ã™ã‚‹ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚å¿…è¦ãªã‚‰ã€æ¬¡ã«ãã®ã‚³ãƒ¼ãƒ‰ã‚‚ä½œã‚Œã¾ã™ãŒã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ã§å®Œçµã—ã¦ä¿å­˜ã§ãã¾ã™ã€‚

ã“ã®ã‚ã¨ã€ã‚µãƒ¼ãƒã«é€ä¿¡ã—ã¦ä¿å­˜ã™ã‚‹Node.jsç‰ˆã‚‚ä½œã‚Šã¾ã™ã‹ï¼Ÿ
ãã†ã™ã‚Œã°ã‚¯ãƒ©ã‚¦ãƒ‰ã‚„Webã‚¢ãƒ—ãƒªã§ä½¿ãˆã‚‹å½¢ã«ãªã‚Šã¾ã™ã€‚
-->